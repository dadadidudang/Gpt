
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ê¿ˆë¹›íŒŒí‹°ì‹œì—˜ë…¸íŠ¸ Â· ë‹¨ì¼ íŒŒì¼ (iOS ë‚´ë³´ë‚´ê¸° + ì‹¤ì‹œê°„ AI)</title>
<meta name="theme-color" content="#ff6fa5">
<style>
:root{--bg:#fffafc;--ink:#1f1a21;--muted:#6b6570;--accent:#ff6fa5;--border:#eadbe3;--card:#fff;--chip:#ffe3ee}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;background:var(--bg);color:var(--ink);line-height:1.55;font-size:15.5px}
header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border);padding:10px 14px;display:grid;gap:8px}
h1{margin:0;font-size:1.28rem;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
button,.importLabel{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700;font-size:.92rem;text-align:center}
.importLabel{position:relative;display:inline-flex;justify-content:center;align-items:center;overflow:hidden}
#importInput{position:absolute;inset:0;opacity:0;cursor:pointer}
#filters{display:grid;gap:8px;grid-template-columns:1fr auto;padding:10px 14px;align-items:center}
#searchInput,#sortSelect{padding:8px 10px;border:1px solid var(--border);border-radius:10px;font-size:.94rem}
.chips{grid-column:1/-1;display:flex;gap:8px;flex-wrap:wrap}
.chips button{background:var(--chip);color:#7a2a48;border:1px solid var(--border);padding:6px 10px;border-radius:999px;cursor:pointer;font-size:.9rem}
.cards{list-style:none;padding:12px;margin:0;display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.card{display:grid;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.card .thumb{background:#f7eef2;min-height:120px;background-size:cover;background-position:center}
.card .content{padding:12px;display:grid;gap:6px}
.card .title{margin:0;font-size:1.05rem;font-weight:700}
.summary{color:var(--muted);margin:0;min-height:1.1em;font-size:.95rem}
.meta{display:flex;gap:6px;flex-wrap:wrap}
.badge{background:#f8edf2;border:1px solid var(--border);padding:3px 8px;border-radius:999px;font-size:.88rem}
.tags{display:flex;gap:6px;flex-wrap:wrap}
.tags .tag{background:var(--chip);border-radius:999px;padding:2px 7px;border:1px solid var(--border);font-size:.85rem}
.two-col{display:grid;gap:10px;grid-template-columns:1fr}
@media(min-width:720px){.two-col{grid-template-columns:1fr 1fr}}
.card .row{display:flex;gap:8px}
.card .row button{background:#f1e0e7;color:#7a2a48;border:1px solid var(--border);font-size:.9rem}
dialog::backdrop{background:rgba(0,0,0,.4)}dialog{width:min(960px,96vw);border:1px solid var(--border);border-radius:16px;padding:0}
#recipeForm{padding:16px;display:grid;gap:10px}#recipeForm .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}#recipeForm label{display:grid;gap:6px}
textarea,input,select{border:1px solid var(--border);border-radius:10px;padding:10px;width:100%;font-size:.95rem}
menu{display:flex;gap:8px;justify-content:flex-end;margin:0;padding:0}
footer{text-align:center;color:var(--muted);padding:16px}.empty{padding:40px;text-align:center;color:var(--muted)}
#aiFab{position:fixed;right:14px;bottom:20px;z-index:20;background:var(--accent);color:#fff;border:0;padding:12px 14px;border-radius:999px;font-weight:800;box-shadow:0 6px 20px rgba(255,111,165,.35)}
.ai-result{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;margin-top:8px;white-space:pre-wrap}
.toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:999px;font-size:.9rem;opacity:0;transition:.3s;z-index:50}
.toast.show{opacity:1}
.muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <h1>ê¿ˆë¹›íŒŒí‹°ì‹œì—˜ë…¸íŠ¸</h1>
  <div class="actions">
    <button id="newRecipeBtn">+ ìƒˆ ë ˆì‹œí”¼</button>
    <button id="exportBtn">ë‚´ë³´ë‚´ê¸°</button>
    <label class="importLabel">ë¶ˆëŸ¬ì˜¤ê¸°<input type="file" id="importInput" accept="application/json"></label>
  </div>
</header>

<section id="filters">
  <input type="search" id="searchInput" placeholder="ê²€ìƒ‰: ì œëª©, ì¬ë£Œ, íƒœê·¸">
  <select id="sortSelect" aria-label="ì •ë ¬">
    <option value="updatedDesc">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
    <option value="titleAsc">ì œëª© Aâ†’Z</option>
    <option value="timeAsc">ì†Œìš”ì‹œê°„ ì§§ì€ìˆœ</option>
    <option value="timeDesc">ì†Œìš”ì‹œê°„ ê¸´ìˆœ</option>
  </select>
  <div id="tagChips" class="chips"></div>
</section>

<main>
  <ul id="recipeList" class="cards"></ul>
  <button id="aiFab" title="AI ë„ìš°ë¯¸">AI</button>
</main>

<dialog id="recipeDialog">
  <form method="dialog" id="recipeForm">
    <h2 id="dialogTitle">ìƒˆ ë ˆì‹œí”¼</h2>
    <div class="grid">
      <label>ì œëª©*<input name="title" required maxlength="100" placeholder="ì˜ˆ: ë§ì°¨ ì˜¤í˜ë¼"></label>
      <label>ë‚œì´ë„
        <select name="difficulty"><option value="">ì„ íƒ ì—†ìŒ</option><option>ì´ˆê¸‰</option><option>ì¤‘ê¸‰</option><option>ê³ ê¸‰</option></select></label>
      <label>ì†Œìš”ì‹œê°„(ë¶„)<input name="time" type="number" min="0" step="1" placeholder="ì˜ˆ: 90"></label>
      <label>ë¶„ëŸ‰(ì¸ë¶„/ê°œìˆ˜)<input name="yield" maxlength="40" placeholder="ì˜ˆ: 8ì¸ë¶„"></label>
      <label>íƒœê·¸(ì‰¼í‘œë¡œ êµ¬ë¶„)<input name="tags" maxlength="120" placeholder="ì˜ˆ: í”„ë‘ìŠ¤, í‘¸ë”©"></label>
      <label>í‘œì§€ ì´ë¯¸ì§€ URL<input name="image" placeholder="https:// ... (ì„ íƒ)"></label>
    </div>
    <label>í•œ ì¤„ ì†Œê°œ<input name="summary" maxlength="160" placeholder="ì˜ˆ: ë°”ë‹ë¼ í–¥ì´ í¬ì¸íŠ¸ì¸ ê¸°ë³¸ í‘¸ë”©"></label>
    <label>ì¬ë£Œ(í•œ ì¤„ë‹¹ í•˜ë‚˜)
      <textarea name="ingredients" rows="8" placeholder="ìš°ìœ  500ml
ìƒí¬ë¦¼ 200ml
ì„¤íƒ• 70g
ë‹¬ê±€ 3ê°œ
ë°”ë‹ë¼ ë¹ˆ 1/2ê°œ
ì†Œê¸ˆ í•œ ê¼¬ì§‘"></textarea></label>
    <label>ë§Œë“œëŠ” ë²•(ë‹¨ê³„ë³„ë¡œ)
      <textarea name="steps" rows="10" placeholder="1) ì˜¤ë¸ 150Â°C ì˜ˆì—´
2) ìš°ìœ +í¬ë¦¼ì„ ë°ì›Œ í–¥ ìš°ë ¤ë‚´ê¸°
3) ë‹¬ê±€+ì„¤íƒ• ì„ê¸°
4) ë”°ëœ»í•œ ìš°ìœ  í˜¼í•©ë¬¼ ì¡°ê¸ˆì”© ë„£ì–´ ì„ê¸°
5) ì²´ì— ê±¸ëŸ¬ ì¤‘íƒ•ìœ¼ë¡œ 30ë¶„ êµ½ê¸°"></textarea></label>
    <label>ë¹„ê³ /ë©”ëª¨
      <textarea name="notes" rows="6" placeholder="íŒ, ëŒ€ì²´ ì¬ë£Œ, ì‹¤íŒ¨ ë…¸íŠ¸ ë“±"></textarea></label>
    <menu><button value="cancel" id="cancelBtn">ì·¨ì†Œ</button><button id="saveBtn" value="default">ì €ì¥</button></menu>
  </form>
</dialog>

<template id="recipeCardTmpl">
  <li class="card">
    <div class="thumb"></div>
    <div class="content">
      <h3 class="title"></h3>
      <p class="summary"></p>
      <div class="meta"><span class="badge time"></span><span class="badge diff"></span><span class="badge yield"></span></div>
      <div class="tags"></div>
      <details>
        <summary>ë ˆì‹œí”¼ í¼ì¹˜ê¸°</summary>
        <div class="two-col">
          <div><h4>ì¬ë£Œ</h4><ul class="ing"></ul></div>
          <div><h4>ë§Œë“œëŠ” ë²•</h4><ol class="steps"></ol></div>
        </div>
        <div class="notes"></div>
      </details>
      <div class="row"><button class="edit">ìˆ˜ì •</button><button class="delete">ì‚­ì œ</button><button class="dup">ë³µì œ</button></div>
    </div>
  </li>
</template>

<footer><small>ì €ì¥ ìœ„ì¹˜: ì´ ê¸°ê¸° ë¸Œë¼ìš°ì €(localStorage) Â· JSONìœ¼ë¡œ ë°±ì—…í•˜ì„¸ìš”</small></footer>

<dialog id="aiDialog">
  <form method="dialog" id="aiForm">
    <h2>AI ë„ìš°ë¯¸ <small class="muted">(í‚¤ë¥¼ ë„£ìœ¼ë©´ ì‹¤ì œ ì‘ë‹µ)</small></h2>
    <p class="muted">ì¬ë£Œë¡œ ë ˆì‹œí”¼ ì¶”ì²œ, ë‹¨ê³„ ìš”ì•½, ë‹¨ìœ„ ë³€í™˜ ë“±ì„ ë¬¼ì–´ë³´ì„¸ìš”.</p>
    <textarea id="aiInput" rows="4" placeholder="ì˜ˆ: ë‹¬ê±€Â·ìš°ìœ Â·ë§ì°¨ë¡œ ë””ì €íŠ¸ ì¶”ì²œ"></textarea>
    <menu><button value="cancel">ë‹«ê¸°</button><button id="aiAskBtn" value="default">ì§ˆë¬¸ ë³´ë‚´ê¸°</button></menu>
    <div id="aiResult" class="ai-result"></div>
    <hr>
    <details>
      <summary>ì„¤ì •: OpenAI API í‚¤ ì—°ê²°</summary>
      <label>OpenAI API Key
        <input type="password" id="apiKeyInput" placeholder="sk-..." style="width:100%">
      </label>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button type="button" id="saveKeyBtn">í‚¤ ì €ì¥</button>
        <button type="button" id="clearKeyBtn" style="background:#bbb">í‚¤ ì‚­ì œ</button>
      </div>
      <p class="muted" id="keyStatus"></p>
    </details>
  </form>
</dialog>

<div id="toast" class="toast">ë³µì‚¬ ì™„ë£Œ</div>

<script>
(()=>{
  const el=s=>document.querySelector(s);
  const storageKey='gppn.single.recipes.v3';
  let state={recipes:load(),search:'',tagFilter:'',sort:'updatedDesc'};

  const list=el('#recipeList'), searchInput=el('#searchInput'), sortSelect=el('#sortSelect'),
        tagChips=el('#tagChips'), dialog=el('#recipeDialog'), form=el('#recipeForm'),
        newBtn=el('#newRecipeBtn'), exportBtn=el('#exportBtn'), importInput=el('#importInput'),
        dialogTitle=el('#dialogTitle'), aiDialog=el('#aiDialog'), aiFab=el('#aiFab'),
        aiInput=el('#aiInput'), aiResult=el('#aiResult'), aiAskBtn=el('#aiAskBtn'),
        apiKeyInput=el('#apiKeyInput'), saveKeyBtn=el('#saveKeyBtn'), clearKeyBtn=el('#clearKeyBtn'),
        keyStatus=el('#keyStatus');

  // UI events
  newBtn.addEventListener('click',()=>openForm());
  exportBtn.addEventListener('click',exportJSON);
  importInput.addEventListener('change',importJSON);
  searchInput.addEventListener('input',e=>{state.search=e.target.value.trim();render();});
  sortSelect.addEventListener('change',e=>{state.sort=e.target.value;render();});
  el('#cancelBtn').addEventListener('click',()=>{ if(dialog.close) dialog.close(); else dialog.removeAttribute('open'); });

  aiFab.addEventListener('click',()=>{
    (aiDialog.showModal?aiDialog.showModal():aiDialog.setAttribute('open',''));
    const saved = localStorage.getItem('gppn.apiKey') || '';
    apiKeyInput.value = saved;
    keyStatus.textContent = saved ? 'ğŸ” í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆì–´ìš”. ì‹¤ì œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”.' : 'ğŸ§ª í‚¤ê°€ ì—†ì–´ì„œ ë°ëª¨ ì‘ë‹µë§Œ ë‚˜ì™€ìš”.';
  });

  saveKeyBtn?.addEventListener('click',()=>{
    const v=apiKeyInput.value.trim();
    if(!v){ alert('í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (sk-ë¡œ ì‹œì‘)'); return; }
    localStorage.setItem('gppn.apiKey', v);
    keyStatus.textContent='ğŸ” ì €ì¥ ì™„ë£Œ. ì´ì œ ì‹¤ì œ ì‘ë‹µì´ ë‚˜ì˜µë‹ˆë‹¤.';
    alert('API í‚¤ ì €ì¥ ì™„ë£Œ!');
  });
  clearKeyBtn?.addEventListener('click',()=>{
    localStorage.removeItem('gppn.apiKey'); apiKeyInput.value=''; keyStatus.textContent='ğŸ§ª í‚¤ ì‚­ì œë¨. ë°ëª¨ ì‘ë‹µìœ¼ë¡œ ì „í™˜.';
  });

  aiAskBtn?.addEventListener('click', async (e)=>{
    e.preventDefault();
    const q = (aiInput?.value || '').trim(); if(!q) return;
    const key = localStorage.getItem('gppn.apiKey');
    aiResult.textContent = key ? 'ìƒê° ì¤‘â€¦' : 'ğŸ§ª ë°ëª¨ ì‘ë‹µ(í‚¤ ë¯¸ì„¤ì •). ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ë„£ìœ¼ë©´ ì‹¤ì œ í˜¸ì¶œë¡œ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.\n\n' + demoAI();
    if(!key) return;

    // ì‹¤ì œ OpenAI API í˜¸ì¶œ (chat.completions)
    try{
      const model = 'gpt-4o-mini';
      const r = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
        body: JSON.stringify({
          model,
          messages: [
            {role:'system', content:'ë„ˆëŠ” ë””ì €íŠ¸/ë² ì´í‚¹ ë ˆì‹œí”¼ë¥¼ ì˜ ë„ì™€ì£¼ëŠ” ì¡°ë¦¬ ë³´ì¡° ì…°í”„ì•¼. í•œêµ­ì–´ë¡œ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ë‹µí•´ì¤˜.'},
            {role:'user', content: q}
          ],
          temperature: 0.7
        })
      });
      if(!r.ok){
        const txt = await r.text();
        aiResult.textContent = 'âŒ í˜¸ì¶œ ì‹¤íŒ¨: ' + r.status + ' ' + txt.slice(0,200);
        return;
      }
      const data = await r.json();
      const msg = data.choices?.[0]?.message?.content || '(ì‘ë‹µ ì—†ìŒ)';
      aiResult.textContent = msg;
    }catch(err){
      aiResult.textContent = 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + (err?.message || err);
    }
  });

  function demoAI(){
    return [
      "â€¢ ì¬ë£Œ ë¶„ì„: 'ë§ì°¨, ìš°ìœ , ë‹¬ê±€' â†’ ë§ì°¨ í‘¸ë”©/ë§ì°¨ í¬ë¦¼ë¸Œë¥„ë ˆ ì¶”ì²œ",
      "â€¢ ë‹¨ìœ„ ë³€í™˜: ì„¤íƒ• 3 Tbsp â‰ˆ 37~40 g",
      "â€¢ ì‹œê°„ ìŠ¤ì¼€ì¤„: êµ½ê¸° 20ë¶„ + íœ´ì§€ 10ë¶„ â†’ ì´ 30ë¶„",
      "â€¢ ëŒ€ì²´ ì¬ë£Œ: ë²„í„°â†’ì‹ë¬¼ì„± ë§ˆê°€ë¦°(í’ë¯¸â†“), ìš°ìœ â†’ë‘ìœ (ìˆ˜ë¶„ ì¡°ì ˆ í•„ìš”)"
    ].join("\n");
  }

  form.addEventListener('submit',e=>{
    e.preventDefault();
    const data=formToRecipe(new FormData(form));
    if(!data.title)return;
    if(form.dataset.editId){
      const idx=state.recipes.findIndex(r=>r.id===form.dataset.editId);
      if(idx!==-1){data.id=state.recipes[idx].id;data.createdAt=state.recipes[idx].createdAt;data.updatedAt=Date.now();state.recipes[idx]=data;}
    }else{
      data.id=crypto.randomUUID();data.createdAt=Date.now();data.updatedAt=Date.now();state.recipes.unshift(data);
    }
    save(); if(dialog.close) dialog.close(); render();
  });

  function formToRecipe(fd){
    const get=n=>(fd.get(n)||'').toString().trim();
    const parseLines=v=>get(v).split(/\r?\n/).map(s=>s.replace(/^\d+\)\s*/,'').trim()).filter(Boolean);
    const parseTags=v=>get(v).split(',').map(s=>s.trim()).filter(Boolean);
    return { title:get('title'), difficulty:get('difficulty'), time:get('time')?Number(get('time')):null,
      yield:get('yield'), tags:parseTags('tags'), image:get('image'), summary:get('summary'),
      ingredients:parseLines('ingredients'), steps:parseLines('steps'), notes:get('notes') };
  }

  function load(){
    try{ const raw=localStorage.getItem(storageKey); if(!raw) return demo();
      const data=JSON.parse(raw); return Array.isArray(data)?data:demo(); }catch{ return demo(); }
  }
  function save(){ localStorage.setItem(storageKey, JSON.stringify(state.recipes)); updateTags(); }

  function exportJSON(){
    const data = JSON.stringify(state.recipes, null, 2);
    const ua = navigator.userAgent || '';
    const isIOS = /iPhone|iPad|iPod/.test(ua);
    const isSafari = /Safari/.test(ua) && !/CriOS|FxiOS|EdgiOS/.test(ua);
    const isWebView = isIOS && !isSafari;

    if(isWebView && navigator.clipboard){
      navigator.clipboard.writeText(data).then(()=> showToast('ë³µì‚¬ ì™„ë£Œ! ë©”ëª¨/íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.') );
      return;
    }
    const blob = new Blob([data], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'dessert-recipes.json'; a.click();
    URL.revokeObjectURL(url);
  }

  function importJSON(e){
    const file = e.target.files?.[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const arr = JSON.parse(reader.result);
        if(!Array.isArray(arr)) throw 0;
        const map = new Map(state.recipes.map(r=>[r.id,r]));
        for(const r of arr){
          if(r.id && map.has(r.id)) continue;
          r.id = r.id || crypto.randomUUID();
          r.createdAt = r.createdAt || Date.now();
          r.updatedAt = Date.now();
          state.recipes.push(r);
        }
        save(); render();
      }catch{ alert('ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”. JSON í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); }
    };
    reader.readAsText(file); e.target.value='';
  }

  function render(){
    const q = state.search.toLowerCase();
    const filtered = state.recipes.filter(r=>{
      const hay=[r.title,r.summary,(r.ingredients||[]).join(' '),(r.tags||[]).join(' ')].join(' ').toLowerCase();
      const matchQ = !q || hay.includes(q);
      const matchTag = !state.tagFilter || (r.tags||[]).includes(state.tagFilter);
      return matchQ && matchTag;
    }).sort((a,b)=>{
      switch(state.sort){
        case 'titleAsc': return (a.title||'').localeCompare(b.title||'');
        case 'timeAsc': return (a.time||1e12)-(b.time||1e12);
        case 'timeDesc': return (b.time||-1)-(a.time||-1);
        default: return (b.updatedAt||0)-(a.updatedAt||0);
      }
    });

    const main=document.querySelector('main');
    main.querySelector('#recipeList')?.remove();
    const ul=document.createElement('ul'); ul.id='recipeList'; ul.className='cards';
    main.insertBefore(ul, document.getElementById('aiFab'));

    if(!filtered.length){
      const div=document.createElement('div'); div.className='empty'; div.textContent='ë ˆì‹œí”¼ê°€ ì—†ì–´ìš”. ìœ„ì—ì„œ ìƒˆ ë ˆì‹œí”¼ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!';
      main.insertBefore(div, document.getElementById('aiFab')); return;
    }
    for(const r of filtered) ul.appendChild(card(r));
  }

  function card(r){
    const tpl=document.querySelector('#recipeCardTmpl').content.cloneNode(true);
    const li=tpl.querySelector('.card');
    const thumb=tpl.querySelector('.thumb');
    const title=tpl.querySelector('.title');
    const summary=tpl.querySelector('.summary');
    const time=tpl.querySelector('.time');
    const diff=tpl.querySelector('.diff');
    const yd=tpl.querySelector('.yield');
    const tags=tpl.querySelector('.tags');
    const ing=tpl.querySelector('.ing');
    const steps=tpl.querySelector('.steps');
    const notes=tpl.querySelector('.notes');
    const editBtn=tpl.querySelector('.edit');
    const delBtn=tpl.querySelector('.delete');
    const dupBtn=tpl.querySelector('.dup');

    title.textContent=r.title||'(ì œëª© ì—†ìŒ)';
    summary.textContent=r.summary||'';
    time.textContent=r.time?`â± ${r.time}ë¶„`:'â± ì‹œê°„ ë¯¸ì…ë ¥';
    diff.textContent=r.difficulty?`ğŸ§ ${r.difficulty}`:'ğŸ§ ë‚œì´ë„ ë¯¸ì…ë ¥';
    yd.textContent=r.yield?`ğŸ½ ${r.yield}`:'';
    if(r.image) thumb.style.backgroundImage=`url('${r.image}')`;

    (r.tags||[]).forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=`#${t}`;
      s.addEventListener('click',()=>{state.tagFilter=t; updateTags(); render();}); tags.appendChild(s); });
    (r.ingredients||[]).forEach(i=>{ const li=document.createElement('li'); li.textContent=i; ing.appendChild(li); });
    (r.steps||[]).forEach(s=>{ const li=document.createElement('li'); li.textContent=s; steps.appendChild(li); });
    notes.textContent=r.notes||'';

    editBtn.addEventListener('click',()=>openForm(r));
    delBtn.addEventListener('click',()=>{ if(confirm('ì´ ë ˆì‹œí”¼ë¥¼ ì‚­ì œí• ê¹Œìš”?')){ state.recipes=state.recipes.filter(x=>x.id!==r.id); save(); render(); } });
    dupBtn.addEventListener('click',()=>{ const copy=JSON.parse(JSON.stringify(r)); copy.id=crypto.randomUUID(); copy.title=r.title+' (ë³µì œ)'; copy.createdAt=Date.now(); copy.updatedAt=Date.now(); state.recipes.unshift(copy); save(); render(); });

    return li;
  }

  function updateTags(){
    const all=new Set(); for(const r of state.recipes) (r.tags||[]).forEach(t=>all.add(t));
    tagChips.innerHTML='';
    if(state.tagFilter){
      const clear=document.createElement('button'); clear.textContent=`íƒœê·¸ í•´ì œ: #${state.tagFilter}`;
      clear.addEventListener('click',()=>{ state.tagFilter=''; render(); updateTags(); }); tagChips.appendChild(clear);
    }
    for(const t of Array.from(all).sort((a,b)=>a.localeCompare(b))){
      const b=document.createElement('button'); b.textContent=`#${t}`; b.addEventListener('click',()=>{ state.tagFilter=t; render(); updateTags(); }); tagChips.appendChild(b);
    }
  }

  function openForm(r=null){
    form.reset(); delete form.dataset.editId; el('#dialogTitle').textContent='ìƒˆ ë ˆì‹œí”¼';
    if(r){ el('#dialogTitle').textContent='ë ˆì‹œí”¼ ìˆ˜ì •'; form.title.value=r.title||''; form.difficulty.value=r.difficulty||'';
      form.time.value=r.time||''; form.yield.value=r.yield||''; form.tags.value=(r.tags||[]).join(', ');
      form.image.value=r.image||''; form.summary.value=r.summary||''; form.ingredients.value=(r.ingredients||[]).join('\n');
      form.steps.value=(r.steps||[]).map((s,i)=>`${i+1}) ${s}`).join('\n'); form.notes.value=r.notes||''; form.dataset.editId=r.id; }
    if(dialog.showModal) dialog.showModal(); else dialog.setAttribute('open','');
  }

  function showToast(t){ const toast=el('#toast'); toast.textContent=t; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1400); }

  function demo(){ return [{
    id:crypto.randomUUID(), title:'ë°”ë‹ë¼ ë¹ˆ í‘¸ë”©',
    summary:'ì‹¬í”Œí•˜ì§€ë§Œ í’ˆê²© ìˆëŠ” ê¸°ë³¸ í‘¸ë”©. ë§ˆë‹¤ê°€ìŠ¤ì¹´ë¥´ ë°”ë‹ë¼ì˜ í–¥ì´ í¬ì¸íŠ¸.',
    difficulty:'ì´ˆê¸‰', time:35, yield:'4ì¸ë¶„', tags:['ê¸°ë³¸','í‘¸ë”©','í”„ë‘ìŠ¤'], image:'',
    ingredients:['ìš°ìœ  500ml','ìƒí¬ë¦¼ 200ml','ì„¤íƒ• 70g','ë‹¬ê±€ 3ê°œ','ë°”ë‹ë¼ ë¹ˆ 1/2ê°œ','ì†Œê¸ˆ í•œ ê¼¬ì§‘'],
    steps:['ì˜¤ë¸ 150Â°C ì˜ˆì—´','ìš°ìœ +í¬ë¦¼+ë°”ë‹ë¼ ë°ì›Œ í–¥ ìš°ë ¤ë‚´ê¸°','ë‹¬ê±€+ì„¤íƒ• ì„ê¸°','ë”°ëœ»í•œ ìš°ìœ  í˜¼í•©ë¬¼ ì¡°ê¸ˆì”© ë„£ì–´ ì„ê¸°','ì²´ì— ê±¸ëŸ¬ ì¤‘íƒ•ìœ¼ë¡œ 30ë¶„ êµ½ê¸°','ì‹í˜€ì„œ ëƒ‰ì¥'],
    notes:'ì„¤íƒ• ì¼ë¶€ë¥¼ í‘ì„¤íƒ•ìœ¼ë¡œ ë°”ê¾¸ë©´ í’ë¯¸ ì—….', createdAt:Date.now(), updatedAt:Date.now()
  }]; }

  updateTags(); render();
})();
</script>
</body>
</html>
